function toggleLeafletControls(){return $(".leaflet-control-container").toggle()}function makeTimestamp(t){return t+=(new Date).getTime()}function changeLoadingHTML(t){return $(".loading").data("lasthtml",$(".loading").html()).html(t)}function removeImage(t,e){if($(t.target).hasClass("fullSizeImageContainer")||$(t.target).hasClass("helper")||$(t.target).hasClass("closer")){if(e){var n=e.find("img");preparent=n.data("preparent"),preCSS=n.data("preCSS"),after=n.data("after"),preparent&&n.insertBefore(after).css("margin",preCSS).removeClass("fullsize"),e.stop().fadeOut(1e3).delay(1e3).remove()}toggleLeafletControls()}}function displayImage(t){var e=$("<span></span>").addClass("helper"),n="string"!=typeof t?$(t):$(document.createElement("img")).addClass("trans").attr("src",t);if(n.hasClass("fullsize"))return!1;n.data("preCSS",n.css("margin")).data("preparent",n.parent()).data("after",n.next()).appendTo(e).addClass("fullsize");var o=$("<div>c  l  o  s  e</div>").addClass("closer").addClass("trans").on("click",function(t){removeImage(t,r)}),r=$("<div></div>").addClass("fullSizeImageContainer").addClass("fullcontainer").addClass("trans").addClass("image").addClass("noBounce").append(o).append(e).prependTo("body").one("dblclick",function(t){removeImage(t,r)}).one("contextmenu",function(t){removeImage(t,r)});toggleLeafletControls()}function stopProp(t){return t.preventDefault(),t.stopPropagation(),t}function makeid(){for(var t="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;5>n;n++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}function checkConnection(){if(navigator.connection&&navigator.connection.type){var t=navigator.connection.type,e={};return Connection&&(e[Connection.UNKNOWN]=!1,e[Connection.ETHERNET]=!0,e[Connection.WIFI]=!0,e[Connection.CELL_2G]=!0,e[Connection.CELL_3G]=!0,e[Connection.CELL_4G]=!0,e[Connection.CELL]=!0,e[Connection.NONE]=!1),e[t]?!0:navigator.onLine}return-1!==Object.keys(navigator).indexOf("onLine")?navigator.onLine:!0}function decodeFromBase64(t){return atob(t)}function dataURItoBlob(t){var e;e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var n=t.split(",")[0].split(":")[1].split(";")[0],o=new ArrayBuffer(e.length),r=new Uint8Array(o),a=0;a<e.length;a++)r[a]=e.charCodeAt(a);return new Blob([o],{type:n})}function autosize(){}function showloading(){$(".appName").addClass("loading")}function hideloading(){$(".appName.loading").removeClass("loading")}function switch_tab(t){for(var e=document.getElementsByTagName("div"),n=0;n<e.length;n++){var o=e[n];"model_container"==o.className&&(o.style.display=o.id=="Data_"+t?"block":"none")}var r=document.getElementsByTagName("td");for(n=0;n<r.length;n++){var a=r[n];if("selected"==a.className){a.className="tab";break}}document.getElementById("Tab_"+t).className="selected"}function toggle_extra_info(){for(var t=document.getElementsByTagName("tr"),e=0;e<t.length;e++){var n=t[e];"extra_info"==n.id&&(n.style.display="none"==n.style.display?"":"none")}for(var o=document.getElementsByName("additional_data"),e=0;e<o.length;e++){var r=o[e];r.innerHTML="Show Additional Data"==r.innerHTML?"Hide Additional Data":"Show Additional Data"}}function switch_extended(){var t=document.getElementById("Extended_Native"),e=document.getElementById("Extended_Hourly"),n=document.getElementById("switch_extended");"block"==t.style.display?(t.style.display="none",e.style.display="block",n.innerHTML="Fewer Hours",document.cookie="qlvt=1;expires=Tue, 31 Dec 2030 00:00:00 UTC"):(t.style.display="block",e.style.display="none",n.innerHTML="More Hours",document.cookie="qlvt=0;expires=Tue, 31 Dec 2030 00:00:00 UTC")}function loadMeteogram(t,e){showloading(),t=$(t),$.getJSON("http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20html%20where%20url%3D%22"+encodeURIComponent(e)+"%22&format=xml'&callback=?",function(e){if(e.results[0]){var e=($('<div class="closer">close</div>').on("click",function(){$(this).closest(".removeme").remove()}),filterData(e.results[0])),n=$(e).find(".meteogram");n.find(" > :not(table, .heading, .model_container)").remove(),n.find("a[href]:not([href^=javascript])").attr("target","_blank").each(function(){$(this).attr("href","http://www.iwindsurf.com/"+$(this).attr("href"))}),displayImage(n)}else{var o="<p>Error: could not load the page.</p>";t.html(o)}hideloading()})}function filterData(t){return t=t.replace(/<?\/body[^>]*>/g,""),t=t.replace(/[\r|\n]+/g,""),t=t.replace(/<--[\S\s]*?-->/g,""),t=t.replace(/<noscript[^>]*>[\S\s]*?<\/noscript>/g,""),t=t.replace(/<script[^>]*>[\S\s]*?<\/script>/g,""),t=t.replace(/<script.*\/>/,""),t=t.replace(/src="/g,'src="http://www.iwindsurf.com/')}!function(){for(var t,e=function(){},n=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],o=n.length,r=window.console=window.console||{};o--;)t=n[o],r[t]||(r[t]=e)}(),$(".loading").data("inithtml",$(".loading").html()),window.bouncefix&&bouncefix.add("noBounce"),window.$&&($(".loading").bind("dragstart",stopProp).bind("selectstart",stopProp),$.fn.insertAt=function(t,e){var n=this.children().clone(!0),o=$.makeArray(n);return o.splice(e,0,t),this.empty().append(o),this},$.support.cors=!0,$.fn.css2=jQuery.fn.css,$.fn.css=function(){if(arguments.length)return jQuery.fn.css2.apply(this,arguments);for(var t=["font-family","font-size","font-weight","font-style","color","text-transform","text-decoration","letter-spacing","word-spacing","line-height","text-align","vertical-align","direction","background-color","background-image","background-repeat","background-position","background-attachment","opacity","width","height","top","right","bottom","left","margin-top","margin-right","margin-bottom","margin-left","padding-top","padding-right","padding-bottom","padding-left","border-top-width","border-right-width","border-bottom-width","border-left-width","border-top-color","border-right-color","border-bottom-color","border-left-color","border-top-style","border-right-style","border-bottom-style","border-left-style","position","display","visibility","z-index","overflow-x","overflow-y","white-space","clip","float","clear","cursor","list-style-image","list-style-position","list-style-type","marker-offset"],e=t.length,n={},o=0;e>o;o++)n[t[o]]=jQuery.fn.css2.call(this,t[o]);return n},$.each(["show","hide"],function(t,e){var n=$.fn[e];$.fn[e]=function(){return this.trigger(e),n.apply(this,arguments)}})),Object.keys||(Object.keys=function(){"use strict";var t=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],o=n.length;return function(r){if("object"!=typeof r&&("function"!=typeof r||null===r))throw new TypeError("Object.keys called on non-object");var a,i,s=[];for(a in r)t.call(r,a)&&s.push(a);if(e)for(i=0;o>i;i++)t.call(r,n[i])&&s.push(n[i]);return s}}()),Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){if(void 0===this||null===this)throw new TypeError('"this" is null or not defined');var n=this.length>>>0;for(e=+e||0,1/0===Math.abs(e)&&(e=0),0>e&&(e+=n,0>e&&(e=0));n>e;e++)if(this[e]===t)return e;return-1}),Array.prototype.some||(Array.prototype.some=function(t){"use strict";if(void 0===this||null===this)throw new TypeError;var e=Object(this),n=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var o=arguments.length>=2?arguments[1]:void 0,r=0;n>r;r++)if(r in e&&t.call(o,e[r],r,e))return!0;return!1}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){var n,o;if(null==this)throw new TypeError(" this is null or not defined");var r=Object(this),a=r.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(e&&(n=e),o=0;a>o;){var i;o in r&&(i=r[o],t.call(n,i,o,r)),o++}});var mimes={png:"image/png",jpg:"image/jpeg",gif:"image/gif"},vidimgs={"OB-Kelly's Cove":function(){return $("<img src='http://ob-kc.com/images/current_sm.jpg?"+(new Date).getTime()+"'/>").on("click",function(){displayImage(this)}).css("cursor","pointer")},"OB Fulton":function(){return $("<img src='http://camstills.cdn-surfline.com/oceanbeachncam/latest_small.jpg?"+(new Date).getTime()+"'/>").on("click",function(){displayImage(this)}).css("cursor","pointer")},"SF Zoo":function(){return $("<img src='http://camstills.cdn-surfline.com/obsfsouthcam/latest_small.jpg?"+(new Date).getTime()+"'/>").on("click",function(){displayImage(this)}).css("cursor","pointer")},"Santa Cruz Boardwalk":function(){return $("<img src='http://camstills.cdn-surfline.com/steamercam/latest_small.jpg?"+(new Date).getTime()+"'/>").on("click",function(){displayImage(this)}).css("cursor","pointer")},"East Cliff":function(){return $("<img src='http://camstills.cdn-surfline.com/pleasureptcam/latest_small.jpg?"+(new Date).getTime()+"'/>").on("click",function(){displayImage(this)}).css("cursor","pointer")},"Surfer's Point at Seaside Park":function(){return $("<img src='http://camstills.cdn-surfline.com/venturacam/latest_small.jpg?"+(new Date).getTime()+"'/>").on("click",function(){displayImage(this)}).css("cursor","pointer")},"Malibu Hills":function(){return $("<img src='http://camstills.cdn-surfline.com/malibucam/latest_small.jpg?"+(new Date).getTime()+"'/>").on("click",function(){displayImage(this)}).css("cursor","pointer")}},app=window.app=app||{},vendorprefix=function(){var t=window.getComputedStyle(document.documentElement,""),e=(Array.prototype.slice.call(t).join("").match(/-(moz|webkit|ms)-/)||""===t.OLink&&["","o"])[1],n="WebKit|Moz|MS|O".match(new RegExp("("+e+")","i"))[1];return{dom:n,lowercase:e,css:"-"+e+"-",js:e[0].toUpperCase()+e.substr(1)}}();!function(t,e,n,o){"use strict";function r(){var t=m.getBounds();return p+"&minLat="+t.getSouth()+"&minLon="+t.getWest()+"&maxLat="+t.getNorth()+"&maxLon="+t.getEast()+"&zoomLevel="+m.getZoom()}function a(t){t=t||o.stations,t&&m.removeLayer(t)}function i(){return n.layerGroup().addTo(m)}function s(e){if("abort"!==e.statusText){a();var r=o.stations=i(),s=JSON.parse(JSON.parse(e.responseText).error.split("//Total time:")[0]);console.log(s[0]),$.each(s,function(){var e=this.sensorReadings.length>0?this.sensorReadings[0].direction:"",o=this.sensorReadings.length>0?this.sensorReadings[0].average:"",a=this.sensorReadings.length>0?this.sensorReadings[0].gust:"",i=this.sensorReadings.length>0?this.sensorReadings[0].temperature:"",s=this.fullName||"",l=this.fullName||"",c=e+(o?", avg: "+o:"")+(a?", gust: "+a:"");if(c){var d,p=2*(parseFloat(o)||1),u=a?2*parseFloat(a):p;t.vidimgs&&(d=vidimgs[this.id]||vidimgs[this.fullName]);var f,g=1/Math.abs(p-u)*10,h='<div class="station" title="'+l+" "+(c||"no data")+'" style="font-size:'+p+"px; transition: all "+g+'s linear;">&#10148;</div>';(-1!==e.indexOf("E")||"N"===e)&&(f="green"),-1!==e.indexOf("W")&&(f="red"),f||(f="gray");var y=n.divIcon({html:h,iconsSize:[p,p],iconAnchor:[p/2-3,p],className:["direction",e,f].join(" ")}),v="http://www.iwindsurf.com/windandwhere.iws?regionID=1669&ISection=Forecast+Graphs&location_id="+this.id,w=$('<div class="fullcontainer meteogram-container"></div>'),b=$('<a class="showmeteogram">Show Meteogram</a>').on("click",function(){loadMeteogram(w,v)}),C=$("<div><h3>"+s+"</h3></div>").append(c).append(i?"<br/>"+i+"&deg;":"").append(d?d instanceof Function?d():d:"").append('<a target="_blank" href="'+v+'"> forecast </a>').append(b),x=n.marker([this.baseLat,this.baseLon],{icon:y}).bindPopup(C[0]).on("mouseover",function(){this.infocus=!0;$(this._icon).find("div").css("text-shadow",f+" "+(u-p)+"px 0px 0px")}).on("mouseout",function(){this.infocus=!1;$(this._icon).find("div").css("text-shadow","")}).addTo(r);p!==u&&setTimeout(function(){var t=setInterval(function(){(!x||x&&!m.hasLayer(x))&&clearInterval(t);var e;x.infocus||(e=x._gusted||0),e=2===e?0:e+=1,$(x._icon).find("div").css("text-shadow",-1!==[2,0].indexOf(e)?"transparent "+(u-p)*e+"px 0px 0px":f+" "+(u-p)*e+"px 0px 0px"),x._gusted=e},1e3*g)},1e3*g)}}),hideloading()}}function l(t){o.ajaxCall&&o.ajaxCall.abort(),o.ajaxCall=$.get(u+encodeURIComponent(t),s).success(function(t){s(t)}).error(function(t){s(t)})}function c(){return m.hasPopup?!1:(showloading(),void l(r()))}function d(t){return console.log(t),m.hasPopup&&m.closePopup(),m}var p=(vendorprefix.css+"transform","http://www.iwindsurf.com/json/dyn_weatherstation.php?region_id=1669&units=mph&tunits=F"),u="https://jsonp.nodejitsu.com/?url=",m=o.map=n.map("map",{center:[37.83853,-122.39182],zoom:10,minZoom:6}).on("popupopen",function(){this.hasPopup=!0}).on("popupclose",function(){this.hasPopup=!1}).on("moveend",c).on("startfollowing",d).on("zoomend",c);n.control.locate({follow:!0,stopFollowingOnDrag:!0}).addTo(m);var f={position:"topleft",showResultIcons:!0},g=n.Control.geocoder(f).addTo(m);g.markGeocode=function(t){var e=t.bbox;d(),m.fitBounds(e)},c();new n.tileLayer("http://{s}.tile.stamen.com/watercolor/{z}/{x}/{y}.png",{minZoom:0,maxZoom:20,maxNativeZoom:18,attribution:'Map data Â© <a href="http://www.openstreetmap.org">OpenStreetMap contributors</a>'}).addTo(m);o.reloadInterval=setInterval(c,6e4)}(window,document,L,app);